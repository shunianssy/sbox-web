<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ filename }} - 小盒子</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/work_style.css') }}">
</head>
<body>
    <!-- 全局顶部导航（类似 GitHub 顶部） -->
    <header class="global-nav">
        <h2><a href="/">Sbox</a> / <a href="/user/{{ username }}">{{ username }}</a> / {{ filename }}</h2>
        <!-- 可在此添加搜索或用户菜单 -->
    </header>

    <!-- 项目导航 Tabs -->
    <ul class="repo-tabs">
        <li><a href="/scratch/{{ id }}" class="{{ 'active' if not request.args.get('page') else '' }}">Code</a></li>
        <li><a href="/scratch/{{ id }}?page=Issues" class="{{ 'active' if request.args.get('page') == 'Issues' else '' }}">Issues</a></li>
        <li><a href="/scratch/{{ id }}?page=wikis" class="{{ 'active' if request.args.get('page') == 'wikis' else '' }}">Wiki</a></li>
        <li><a href="/scratch/{{ id }}?page=master" class="{{ 'active' if request.args.get('page') == 'master' else '' }}">Insights</a></li>
        <!-- 动态插入的额外链接 -->
        {% if a %}
            <!-- 注意：a 是 HTML 字符串，需确保它输出的是 <li><a>...</a></li> 格式 -->
            {{ a|safe }}
        {% endif %}
        <li><a href="/scratch/{{ id }}?page=Download">Clone</a></li>
        <li><a href="/scratch/{{ id }}?page=license">License: {{ license }}</a></li>
    </ul>

    <div class="main-content">
        <div>
            <p>{{ licenses }}</p>
        </div>
    </div>

    <footer>
        {{ footer|safe }}
    </footer>

    <script>
        // 主题切换（保留你的逻辑）
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const newTheme = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // 点赞/收藏逻辑（不变）
        document.addEventListener('click', async (e) => {
            const target = e.target.closest('a[data-action]');
            if (!target) return;
            e.preventDefault();
            const action = target.dataset.action;
            const id = target.dataset.id;

            try {
                const res = await fetch(`/scratch${action}=${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action })
                });

                if (!res.ok) throw new Error('Network error');
                const data = await res.json();
                if (action === 'like') {
                    target.textContent = `Likes: ${data.like}`;
                } else if (action === 'star') {
                    target.textContent = `Star: ${data.star}`;
                }
            } catch (err) {
                console.error('操作失败:', err);
                alert('操作频繁或网络错误');
            }
        });
    </script>
</body>
</html>